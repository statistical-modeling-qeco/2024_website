---
title: "Random variables and probability distributions"
subtitle: "Serrapilheira/ICTP-SAIFR Training Program in Quantitative Biology and Ecology - 2023"  
author: 
  - "PI (Paulo InÃ¡cio Prado)"
date: '29 January 2024'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
self-contained: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
options(servr.daemon = TRUE)#para que no bloquee la sesiÃ³n
knitr::opts_chunk$set(eval = TRUE, echo = FALSE, warning = FALSE, message = FALSE)
library(ggplot2)
library(ggthemes)
library(dplyr)
library(latex2exp)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#03045E",
  colors = c(
    red = "#A70000",
    white = "#FFFFFF",
    black = "#181818"
  ),
  text_bold_color = "#03045E",
  header_font_google = google_font("Roboto Condensed"),
  text_font_google = google_font("Roboto Condensed", "300", "300i"),
  code_font_google = google_font("Fira Mono"), text_font_size = "32px",
  code_font_size = "32px"
)
xaringanExtra::use_share_again()
xaringanExtra::use_fit_screen()
xaringanExtra::use_tachyons()
xaringanExtra::use_tile_view()
# clipboard
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "Copy code <i class=\"fa fa-clipboard\"></i>",
    success_text = "Copied! <i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "Not copied ðŸ˜• <i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)

## ggplot theme
theme_publication <- function(base_size=14, base_family="helvetica") {
    (theme_foundation(base_size=base_size, base_family=base_family)
        + theme(plot.title = element_text(face = "bold",
                                          size = rel(1.2), hjust = 0.5),
                text = element_text(),
                panel.background = element_rect(colour = NA),
                plot.background = element_rect(colour = NA),
                panel.border = element_rect(colour = NA),
                axis.title = element_text(face = "bold",size = rel(1)),
                axis.title.y = element_text(angle=90,vjust =2),
                axis.title.x = element_text(vjust = -0.2),
                axis.text = element_text(), 
                axis.line = element_line(colour="black"),
                axis.ticks = element_line(),
                panel.grid.major = element_line(colour="#f0f0f0"),
                panel.grid.minor = element_blank(),
                legend.key = element_rect(colour = NA),
                legend.position = "bottom",
                legend.direction = "horizontal",
                legend.key.size= unit(0.2, "cm"),
                ##legend.margin = unit(0, "cm"),
                legend.spacing = unit(0.2, "cm"),
                legend.title = element_text(face="italic"),
                plot.margin=unit(c(10,5,5,5),"mm"),
                strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
                strip.text = element_text(face="bold")
                ))
    
}

## Function to shade under normal curve
## From https://www.r-bloggers.com/2011/04/how-to-shade-under-a-normal-density-in-r/
shadenorm <- function(below = NULL,
                      above = NULL,
                      pcts = c(0.025, 0.975),
                      mu = 0,
                      sig = 1,
                      numpts = 500,
                      color = "gray",
                      dens = 40,
                      justabove = FALSE,
                      justbelow = FALSE,
                      lines = FALSE,
                      between = NULL,
                      outside = NULL) {
  if (is.null(between)) {
      below = ifelse(is.null(below), qnorm(pcts[1], mu, sig), below)
      above = ifelse(is.null(above), qnorm(pcts[2], mu, sig), above)
  }
  if (is.null(outside) == FALSE) {
    below = min(outside)
    above = max(outside)
  }
  lowlim = mu - 4 * sig
  uplim  = mu + 4 * sig
  x.grid = seq(lowlim, uplim, length = numpts)
  dens.all = dnorm(x.grid, mean = mu, sd = sig)
  if (lines == FALSE) {
    plot(x.grid,
         dens.all,
         type = "l",
         xlab = "X",
         ylab = "Density")
  }
  if (lines == TRUE) {
    lines(x.grid, dens.all)
  }
  if (justabove == FALSE) {
    x.below    = x.grid[x.grid < below]
    dens.below = dens.all[x.grid < below]
    polygon(c(x.below, rev(x.below)),
            c(rep(0, length(x.below)), rev(dens.below)),
            col = color,
            density = dens)
  }
  if (justbelow == FALSE) {
    x.above    = x.grid[x.grid > above]
    dens.above = dens.all[x.grid > above]
    polygon(c(x.above, rev(x.above)),
            c(rep(0, length(x.above)), rev(dens.above)),
            col = color,
            density = dens)
  }
  if (is.null(between) == FALSE) {
    from = min(between)
    to   = max(between)
    x.between    = x.grid[x.grid > from & x.grid < to]
    dens.between = dens.all[x.grid > from & x.grid < to]
    polygon(c(x.between, rev(x.between)),
            c(rep(0, length(x.between)), rev(dens.between)),
            col = color,
            density = dens)
  }
}

```

## Today's key concepts

+ Random variables
+ 

---

## Empirical data


```{r drosophila thorax length data}

dthor <- read.csv("42_Van_Heerwaarden_&_Sgro_2011_Dmelanogaster_thorax_length.csv")
## Sample means
dthor.m <-
    dthor %>%
    filter(Sex == "female", Temperature == "25") %>%
    group_by(Population) %>%
    summarise(th.mean = mean(Thorax_length)) %>%
    arrange(th.mean) %>%
    as.data.frame()
```

.pull-left[

* Samples of *Drophilla * from 18 sites in Autralia
* blab
* blaa
* Mean of thoras length of 30 flies from each line

]


.pull-right[
.center[

```{r drosophila pops histogram}
    dthor %>%
    filter(Sex == "female", Temperature == "25") %>%
    mutate(pop = factor(Population, levels = dthor.m$Population)) %>%
    ggplot(aes(x = Thorax_length)) +
    geom_histogram(bins = 8, alpha =0.3) +
    geom_vline(data = dthor.m, aes(xintercept = th.mean), color = "blue", size = 1.5) +
    xlab("Thorax length (mm)") +
    ##geom_density() +
    facet_wrap(~ Population) +
    theme_publication(18)
    
```

]
]

---

## Random variables

.pull-left[

* Real data always show variation, whatever your control
* Some values are more likely than others
* There is a central tendency (or average value)
]


.pull-right[
.center[


```{r drosophila-mean-hist}
dthor.m %>%
    ggplot(aes(th.mean)) +
    geom_histogram(bins = 11, alpha =0.5) +
    geom_rug(col = "blue", size =1.1) +
    xlim(0.97, 1.1) +
    xlab("Mean thorax length (mm)")+
    ylab("Count (# of populations)") +
    ggtitle("Distribution of population means") +
    theme_publication(18)

```

]]

---

## Random variables

.pull-left[

* Real data always show variation, whatever your control
* Some values are more likely than others
* There is a central tendency (or average value)
]

.pull-right[
.center[


```{r}
p1 <-
    dthor.m %>%
    ggplot(aes(th.mean)) +
    geom_histogram(aes(y=after_stat(density)), bins = 11, alpha =0.5) +
    xlim(0.97, 1.1) +
    xlab("Mean thorax length (mm)")+
    ylab("Density") +
    ggtitle("Distribution of population means") +
    theme_publication(18)
p1
```

]]

---

## Density function

.pull-left[

* A continuous counterpart of an histogram. 
* As for the histogram, the area under the curve of a density function is one.

]


.pull-right[
.center[


```{r}
p1  + geom_density(color = "blue", size = 1.5) 
```

]]


---


## Density function

.pull-left[

* A continuous mathematical function $f(x)$ that returns a density
  value for any value of the measurement $x$.

]


.pull-right[
.center[


```{r}
dmd <- density(dthor.m$th.mean)
tmp <- data.frame(x = dmd$x, y = dmd$y)
index <- min(which(tmp$x > 1.015, arr.ind = TRUE))
p2 <-
    dthor.m %>%
    ggplot(aes(th.mean)) +
    geom_density(color = "blue", size = 1.5) +
    xlim(0.97, 1.1) +
    xlab("Mean thorax length (mm)")+
    ylab("Density") +
    ##ggtitle("Distribution of population means") +
    theme_publication(18)

p2  +
    geom_segment(aes(x = x , xend = x, y = 0, yend =y),
                 data = tmp[index,], col = "red",
                 linetype = "dashed", size = 1.1) +
    geom_segment(aes(x = x, xend = 0.97, y = y, yend =y),
                 data = tmp[index,], col = "red",
                 linetype = "dashed", size = 1.1)

    
```

]]


---


## Probability distributions as models


* The density function that we have defined is a **probability distribution**

--

* It is a model that attributes probabilities to data

--

* With this kind of model we can ask many interesting questions like ...



---
class: center, middle

### What's the probability of a mean thorax length of up 1.04 mm?

```{r}

p2 +
    geom_ribbon(aes(x=x, ymin=0, ymax =y),
                data = filter(tmp, x>0.96&x<1.04),
                fill = "blue", alpha =.5)
```



---




## References

+ Gotelli, N.J., Ellison, A.M., Ellison, S.E. and
  S.R.F.H.F.A.M., 2004. A Primer of Ecological Statistics. Sinauer
  Associates Publishers.

+ McElreath, R., 2018. Statistical Rethinking: A Bayesian Course with
  Examples in R and Stan, 2nd ed. CRC Press.
